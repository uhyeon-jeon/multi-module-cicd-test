name: CI/CD Pipeline

on:
  push:
    branches:
      - main
    paths:
      - 'module-common/**'
      - 'module-rest/**'
      - 'module-sub-rest/**'
      - '.github/**'
      - 'gradle/**'
      - '.gitattributes'
      - '.gitignore'
      - 'build.gradle'
      - 'gradlew'
      - 'gradlew.bat'
      - 'settings.gradle'

jobs:
  trigger-module-rest: # moduleA 혹은 moduleC 에 변경사항이 발생한 경우
#    rules:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Jenkins Job for Module A
        if: ${{ contains(github.event.head_commit.modified, 'src/module-rest/')
          || contains(github.event.head_commit.modified, 'src/module-sub-rest/')
          || contains(github.event.head_commit.modified, '*')
          || contains(github.event.head_commit.modified, 'src/module-common/') }}
        uses: appleboy/jenkins-action@master
        with:
          url: "http://14.32.67.117:8080"
          user: "admin"
          token: "118cc157c3712b776f256de09c9aba5c17"
          job: "test-multi-module-rest"
      - name: Trigger Jenkins Job for Module B
        if: ${{ contains(github.event.head_commit.modified, 'src/module-websocket/')
          || contains(github.event.head_commit.modified, 'src/module-sub-socket/')
          || contains(github.event.head_commit.modified, '*')
          || contains(github.event.head_commit.modified, 'src/module-common/') }}
        uses: appleboy/jenkins-action@master
        with:
          url: "http://14.32.67.117:8080"
          user: "admin"
          token: "118cc157c3712b776f256de09c9aba5c17"
          job: "test-multi-module-websocket"